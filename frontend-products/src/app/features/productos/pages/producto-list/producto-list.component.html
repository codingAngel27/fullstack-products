<div class="container mt-4">

  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="fw-bold text-secondary m-0">
      <i class="bi bi-box-seam me-2"></i>Gestión de Productos
    </h2>
  </div>

  <div class="card bg-white shadow-sm rounded-3 mb-4 border-0">
    <div class="card-body p-4">
      <form class="row g-3 align-items-end">

        <div class="col-md-3">
          <label class="form-label text-muted small fw-bold">Filtrar por</label>
          <div class="input-group">
            <span class="input-group-text bg-light border-end-0">
              <i class="bi bi-funnel text-secondary"></i>
            </span>
            <select class="form-select border-start-0 ps-0" [(ngModel)]="filterField" name="filterField">
              <option value="marca">Marca</option>
              <option value="modelo">Modelo</option>
            </select>
          </div>
        </div>

        <div class="col-md-4">
          <label class="form-label text-muted small fw-bold">Término de búsqueda</label>
          <div class="input-group">
            <span class="input-group-text bg-light border-end-0">
              <i class="bi bi-search text-secondary"></i>
            </span>
            <input type="text" class="form-control border-start-0 ps-0" placeholder="Escribe para buscar..."
              [(ngModel)]="filterValue" name="filterValue" (keyup.enter)="filter()" />
          </div>
        </div>

        <div class="col-md-2 d-grid gap-2">
          <button class="btn btn-primary" (click)="filter()">
            Buscar
          </button>
        </div>
        <div class="col-md-1 d-grid">
          <button class="btn btn-outline-secondary shadow-sm" (click)="clearFilters()" title="Limpiar filtros">
            <i class="bi bi-arrow-counterclockwise"></i>
          </button>
        </div>

        <div class="col-md-2 ms-auto d-grid">
          <button class="btn btn-success text-white fw-semibold shadow-sm" (click)="openCreateModal()">
            <i class="bi bi-plus-lg me-1"></i> Nuevo Producto
          </button>
        </div>
      </form>
    </div>
  </div>

  <div class="card bg-white shadow-sm rounded-3 border-0">
    <div class="card-body p-0">

      <div class="table-responsive">
        <table class="table table-hover align-middle mb-0">
          <thead class="bg-light text-secondary">
            <tr>
              <th class="py-3 px-4 border-bottom-0">Código</th>
              <th class="py-3 border-bottom-0">Nombre</th>
              <th class="py-3 border-bottom-0">Marca</th>
              <th class="py-3 border-bottom-0">Modelo</th>
              <th class="py-3 border-bottom-0">Precio</th>
              <th class="py-3 border-bottom-0 text-center">Stock</th>
              <th class="py-3 px-4 border-bottom-0 text-end">Acciones</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let p of productos">
              <td class="px-4 fw-bold text-primary font-monospace">{{ p.codigo }}</td>

              <td class="fw-semibold text-dark">{{ p.nombre }}</td>
              <td class="text-secondary">{{ p.marca || '-' }}</td>
              <td class="text-secondary">{{ p.modelo || '-' }}</td>

              <td class="fw-bold text-success">
                {{ p.precio | currency:'USD':'symbol':'1.2-2' }}
              </td>

              <td class="text-center">
                <span class="badge rounded-pill" [ngClass]="{
                    'bg-success-subtle text-success border border-success': p.stock > 10,
                    'bg-warning-subtle text-warning border border-warning': p.stock <= 10 && p.stock > 0,
                    'bg-danger-subtle text-danger border border-danger': p.stock === 0
                  }">
                  {{ p.stock }} unid.
                </span>
              </td>

              <td class="text-end px-4">
                <button class="btn btn-sm btn-outline-primary me-2" (click)="openEditModal(p)" title="Editar producto">
                  <i class="bi bi-pencil-square"></i>
                </button>

                <button class="btn btn-sm btn-outline-info me-2" (click)="openDetailModal(p)">
                  <i class="bi bi-eye"></i>
                </button>

                <button class="btn btn-sm btn-outline-danger" (click)="confirmDelete(p)" title="Eliminar producto">
                  <i class="bi bi-trash"></i>
                </button>
              </td>
            </tr>

            <tr *ngIf="productos.length === 0">
              <td colspan="7" class="text-center py-5 text-muted">
                <i class="bi bi-inbox fs-1 d-block mb-2"></i>
                No se encontraron productos.
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div class="card-footer d-flex justify-content-between align-items-center bg-white border-top py-3">
      <button class="btn btn-outline-secondary btn-sm px-3" (click)="changePage(page - 1)" [disabled]="page === 0">
        <i class="bi bi-chevron-left me-1"></i> Anterior
      </button>

      <span class="text-muted small fw-bold">
        Página <span class="text-dark">{{ page + 1 }}</span> de <span class="text-dark">{{ totalPages }}</span>
      </span>

      <button class="btn btn-outline-secondary btn-sm px-3" (click)="changePage(page + 1)"
        [disabled]="page + 1 >= totalPages">
        Siguiente <i class="bi bi-chevron-right ms-1"></i>
      </button>
    </div>
  </div>

</div>

<app-producto-form *ngIf="isModalOpen" [selectedProduct]="selectedProduct" (onSave)="handleSave($event)"
  (onClose)="isModalOpen = false"></app-producto-form>
<app-producto-detail *ngIf="showDetailModal" [product]="detailProduct"
  (onClose)="showDetailModal = false"></app-producto-detail>